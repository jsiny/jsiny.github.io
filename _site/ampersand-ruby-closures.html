<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      What's up with the & (ampersand) in Ruby closures? &middot; Juliette Sinibardy
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />

  <!-- Icons -->
  <link rel="icon" type="image/png" href="/favicon.png" />


  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Google Analytics tracking ID -->


<!-- SEO tags -->
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>What‚Äôs up with the &amp; (ampersand) in Ruby closures? | Juliette Sinibardy</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="What‚Äôs up with the &amp; (ampersand) in Ruby closures?" />
<meta name="author" content="Juliette Sinibardy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A detailed explanation of the subtleties behind using the ampersand (&amp;) in Ruby closures (blocks and Procs)" />
<meta property="og:description" content="A detailed explanation of the subtleties behind using the ampersand (&amp;) in Ruby closures (blocks and Procs)" />
<link rel="canonical" href="http://localhost:4000/ampersand-ruby-closures" />
<meta property="og:url" content="http://localhost:4000/ampersand-ruby-closures" />
<meta property="og:site_name" content="Juliette Sinibardy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-09T08:19:00+02:00" />
<script type="application/ld+json">
{"description":"A detailed explanation of the subtleties behind using the ampersand (&amp;) in Ruby closures (blocks and Procs)","headline":"What‚Äôs up with the &amp; (ampersand) in Ruby closures?","dateModified":"2019-09-09T17:14:00+02:00","datePublished":"2019-09-09T08:19:00+02:00","@type":"BlogPosting","url":"http://localhost:4000/ampersand-ruby-closures","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/ampersand-ruby-closures"},"author":{"@type":"Person","name":"Juliette Sinibardy"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"></path>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path>
</svg></span>
        
        Juliette Sinibardy
      </a>
    </div>
    <p class="lead">Pending Programmer<br> ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 30%</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link " href="/">Home</a>
  
  

  

  


  

  
    
      <a class="page-link " href="/about">About Me</a>
    
  

  
    
      <a class="page-link " href="/contact">Contact</a>
    
  

  
    
  

  

  
    
  

  
    
      <a class="page-link " href="/work">Work History</a>
    
  

  

  
    
  

  
    
  

  

  


  


  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  

  
    
  

  
    
  

  

  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  

  
  
  
  

  
<a id="github-link" class="icon" title="Github" aria-label="Github" href="https://github.com/jsiny">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 28" width="24" height="24">
    <path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

</a>

<a id="medium-link" class="icon" title="Medium" aria-label="Medium" href="https://medium.com/@juju.siny">
  <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" viewbox="0 0 24 24">
    <path d="M12 0c-6.626 0-12 5.372-12 12 0 6.627 5.374 12 12 12 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12zm6.974 17.557v-.235l-1.092-1.072c-.096-.073-.144-.194-.124-.313v-7.874c-.02-.119.028-.24.124-.313l1.118-1.072v-.235h-3.869l-2.758 6.88-3.138-6.88h-4.059v.235l1.308 1.575c.128.115.194.285.176.457v6.188c.038.223-.032.451-.189.614l-1.471 1.784v.235h4.17v-.235l-1.471-1.784c-.158-.163-.233-.389-.202-.614v-5.352l3.66 7.985h.425l3.143-7.985v6.365c0 .17 0 .202-.111.313l-1.13 1.098v.235h5.49z"></path>
</svg>
</a>

<a id="linkedin-link" class="icon" title="LinkedIn" aria-label="LinkedIn" href="https://linkedin.com/in/juliette-sinibardy">
  <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg width="24" height="24" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 490.732 490.732" style="enable-background:new 0 0 490.732 490.732;" xml:space="preserve">
<g>
	<g>
		<path d="M472.366,0.003H18.36C8.219,0.003,0,8.222,0,18.363v454.005c0,10.143,8.219,18.361,18.36,18.361h454.012
			c10.142,0,18.36-8.219,18.36-18.361V18.363C490.727,8.222,482.507,0.003,472.366,0.003z M130.375,403.808
			c0,6.762-5.478,12.238-12.24,12.238H69.132c-6.756,0-12.24-5.477-12.24-12.238V189.625c0-6.763,5.484-12.24,12.24-12.24h49.003
			c6.762,0,12.24,5.477,12.24,12.24V403.808z M130.375,127.482c0,6.763-5.478,12.24-12.24,12.24H69.132
			c-6.756,0-12.24-5.478-12.24-12.24V83.969c0-6.763,5.484-12.24,12.24-12.24h49.003c6.762,0,12.24,5.477,12.24,12.24V127.482z
			 M433.835,403.808c0,6.762-5.483,12.238-12.24,12.238h-49.003c-6.763,0-12.24-5.477-12.24-12.238v-90.436
			c0-29.988-1.566-49.383-4.712-58.189c-3.14-8.807-8.237-15.649-15.3-20.526c-7.062-4.884-15.558-7.32-25.496-7.32
			c-12.729,0-24.149,3.488-34.26,10.459c-10.11,6.977-17.038,16.211-20.79,27.717c-3.745,11.506-5.618,32.779-5.618,63.807v74.488
			c0,6.762-5.483,12.238-12.24,12.238h-49.003c-6.756,0-12.24-5.477-12.24-12.238V189.625c0-6.763,5.483-12.24,12.24-12.24h43.771
			c6.763,0,12.24,5.477,12.24,12.24v16.316c0,6.763,3.312,7.852,7.858,2.852c22.864-25.123,50.753-37.687,83.673-37.687
			c16.212,0,31.028,2.919,44.455,8.758c13.422,5.838,23.58,13.292,30.466,22.356c6.885,9.063,11.683,19.351,14.382,30.857
			c2.699,11.505,4.058,27.98,4.058,49.426V403.808L433.835,403.808z"></path>
	</g>
</g>
</svg>

</a>
  
    <a id="subscribe-link" class="icon" title="Subscribe" aria-label="Subscribe" href="/feed.xml">
    <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <circle cx="6.18" cy="17.82" r="2.18"></circle>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path>
</svg>
  </a>
  
  
    <a id="tags-link" class="icon" title="Tags" aria-label="Tags" href="/tags">
      <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
    </a>
  

  

</nav>
  <p class="copyright">
  ¬© 2019 - Juliette Sinibardy
</p>
</div>

    <main class="container">
        <header>
  <h1 class="post-title">What's up with the &amp; (ampersand) in Ruby closures?</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">09 Sep 2019</span>
  <span class="post-categories">
    
      ‚Ä¢

      
      
      

      
        Ruby
      
    
  </span>
</div>

  <div class="post-body">
    <p>Quite surprisingly, the following Ruby program is correct:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">first_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">second_method</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">second_method</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
  <span class="n">third_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">third_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">block</span><span class="p">.</span><span class="nf">call</span>
<span class="k">end</span>

<span class="n">first_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hello!"</span> <span class="p">}</span>
<span class="c1"># "hello!"</span>
</code></pre></div></div>

<p>You might therefore notice that the <code class="highlighter-rouge">&amp;</code> (ampersand) pops up and disappears 
pretty randomly in the above program. As it‚Äôs pretty hard to wrap one‚Äôs head 
around all this <code class="highlighter-rouge">&amp;</code> madness, let‚Äôs dive into this!</p>

<!--more-->

<ul id="markdown-toc">
  <li><a href="#whats-a-closure" id="markdown-toc-whats-a-closure">What‚Äôs a closure?</a></li>
  <li>
<a href="#blocks" id="markdown-toc-blocks">Blocks</a>    <ul>
      <li><a href="#implicit-block-calling" id="markdown-toc-implicit-block-calling">Implicit Block-Calling</a></li>
      <li><a href="#explicit-block-calling" id="markdown-toc-explicit-block-calling">Explicit Block-Calling</a></li>
    </ul>
  </li>
  <li><a href="#the--within-a-method-call" id="markdown-toc-the--within-a-method-call">The <code class="highlighter-rouge">&amp;</code> within a method call</a></li>
  <li><a href="#explaining-our-initial-example" id="markdown-toc-explaining-our-initial-example">Explaining our initial example</a></li>
  <li><a href="#tldr---its-all-about-context" id="markdown-toc-tldr---its-all-about-context">TL;DR - It‚Äôs all about context!</a></li>
</ul>
<hr>

<h2 id="whats-a-closure">What‚Äôs a closure?</h2>

<p>In this post, we‚Äôll talk about <strong>closures</strong> (and in particular, <em>blocks</em> and
<em>Proc objects</em>). And as I like nothing more than a proper introduction, let‚Äôs
first define a closure.</p>

<p>One of the ‚Äúofficial-looking‚Äù (and pretty unhelpful) definition I have found
is the following:</p>

<blockquote>
  <p>A closure is a first-class function that has lexical scope.</p>
</blockquote>

<p>‚Ä¶ üòí (sigh)</p>

<p>It might help to consider the following instead:</p>

<blockquote>
  <p>A closure is a ‚Äòbunch of code‚Äô that can be defined and saved for later use.</p>
</blockquote>

<p>Additionally, a closure ‚Äòremembers‚Äô its surrounding context at the time it was
initialized, ie. it <em>binds</em> its environment (local variables, method
definitions, constants) to be sure to have everything it needs to run 
successfully.</p>

<p>In Ruby, closures are: Proc objects, blocks and lambdas.</p>

<div style="text-align: center">
    <figure>
        <a href="/assets/images/closure.gif">
            <img src="/assets/images/closure.gif" alt="Friends Serie Dialogue Closure">  
        </a>
        <figcaption>Not exactly *that* type of closure though</figcaption>
    </figure>
</div>

<p>Here, we‚Äôll only talk about blocks and Procs, and more specifically, how 
to call them from methods.</p>

<h2 id="blocks">Blocks</h2>

<p>First, let‚Äôs talk about <em>blocks</em>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">}</span>
</code></pre></div></div>

<p>In the above program, <code class="highlighter-rouge">{ |n| n + 2 }</code> is the block. A block is an ‚Äòunnamed‚Äô
function that can be called implicitly or explicitly.</p>

<h3 id="implicit-block-calling">Implicit Block-Calling</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_method</span>
  <span class="nb">puts</span> <span class="s2">"hi from the method"</span>
<span class="k">end</span>

<span class="n">some_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hi from the block!"</span> <span class="p">}</span>

<span class="c1"># "hi from the method"</span>
</code></pre></div></div>

<p>The above program only outputs the first string (<code class="highlighter-rouge">"hi from the method"</code>)
and somehow forgets about the second string (<code class="highlighter-rouge">"hi from the block!"</code>).</p>

<p>That‚Äôs because even though we implicitly passed the block to the method, 
we didn‚Äôt execute the block within the method. To do that, we‚Äôd need to 
<em>yield to the block</em> by using the keyword <code class="highlighter-rouge">yield</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_method</span>
  <span class="nb">puts</span> <span class="s2">"hi from the method"</span>
  <span class="k">yield</span>
<span class="k">end</span>

<span class="n">some_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hi from the block!"</span> <span class="p">}</span>

<span class="c1"># "hi from the method"</span>
<span class="c1"># "hi from the block!"</span>
</code></pre></div></div>

<p>As a matter of fact, <strong>all Ruby methods can implicitly take a block</strong>, without
needing to specify the block in its argument list or even having to execute 
the block.</p>

<h3 id="explicit-block-calling">Explicit Block-Calling</h3>

<p>When we write a method definition, it can be relevant to explicitly
require a block. To do that, Ruby uses a <code class="highlighter-rouge">&amp;</code> prepending the parameter‚Äôs name:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">yield</span>
<span class="k">end</span>

<span class="n">some_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hi from the explicit block!"</span> <span class="p">}</span>
</code></pre></div></div>

<p>Here, <code class="highlighter-rouge">block</code> acts as a handle (a reference) for the block: within the method
definition, that block is no more an <em>unnamed</em> function.</p>

<p>The <code class="highlighter-rouge">&amp;</code> prefixed to <code class="highlighter-rouge">block</code> signals that any block passed to <code class="highlighter-rouge">some_method</code>
upon method invocation will be converted to a <code class="highlighter-rouge">Proc</code> object.</p>

<p>As such, we can do a bit more than simply <em>yield</em> to it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">block</span><span class="p">.</span><span class="nf">call</span>
<span class="k">end</span>

<span class="n">some_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hi from the explicit block!"</span> <span class="p">}</span>
</code></pre></div></div>

<p>As <code class="highlighter-rouge">block</code> now refers to a <code class="highlighter-rouge">Proc</code> object, we can invoke <code class="highlighter-rouge">call</code> on it. We can
also pass this object to another method like in our initial example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">first_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">second_method</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># rest of the code omitted for brevity</span>

<span class="n">first_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hello!"</span> <span class="p">}</span>
</code></pre></div></div>

<p>Here, the block <code class="highlighter-rouge">{ puts "hello"! }</code> is converted to a <code class="highlighter-rouge">Proc</code> thanks to the <code class="highlighter-rouge">&amp;</code>
prefixed in the method definition, and assigned to the local variable <code class="highlighter-rouge">block</code>.
Then, a second method is invoked and the <code class="highlighter-rouge">Proc</code> object is passed to it as 
an argument.</p>

<p>Notice that we dropped the <code class="highlighter-rouge">&amp;</code> in the <code class="highlighter-rouge">second_method</code> method invocation.</p>

<p>To sum up: in the context of a <strong>method definition</strong>, prepending the last 
parameter with an <code class="highlighter-rouge">&amp;</code> indicates that the method takes an explicit block and that 
this block is converted to a <code class="highlighter-rouge">Proc</code> object (with a name) within the method body.</p>

<h2 id="the--within-a-method-call">The <code class="highlighter-rouge">&amp;</code> within a method call</h2>

<p>As a <a href="/codewars-kata-launch-school-109-oral-assessment">Codewar addict</a>,
I‚Äôve had my fair share of time spent on coming up with ‚Äúone-liners‚Äù, aka
the shortest programs possible.</p>

<p>One of the tricks I use is the <code class="highlighter-rouge">&amp;</code>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">].</span><span class="nf">each</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase!</span><span class="p">)</span>
<span class="c1"># ['A', 'B', 'C']</span>
</code></pre></div></div>

<p>Somehow, this code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase!</span><span class="p">)</span>
</code></pre></div></div>

<p>‚Ä¶is converted to this code:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="o">|</span><span class="n">char</span><span class="o">|</span> <span class="n">char</span><span class="p">.</span><span class="nf">upcase!</span> <span class="p">}</span>
</code></pre></div></div>

<p>Here‚Äôs the mechanism at play here (in the context of a <strong>method invocation</strong>):</p>
<ul>
  <li>Ruby checks whether the object right after the <code class="highlighter-rouge">&amp;</code> is a Proc:
    <ul>
      <li>If it is: great! Ruby uses the Proc object as it is</li>
      <li>If it isn‚Äôt, Ruby calls a <code class="highlighter-rouge">to_proc</code> method on the object, if such a method
exists for that particular class. Fortunately, a <code class="highlighter-rouge">Symbol#to_proc</code> instance 
method does exist. In our example, the <code class="highlighter-rouge">:upcase</code> symbol is therefore 
converted to a <code class="highlighter-rouge">Proc</code> object.</li>
    </ul>
  </li>
  <li>If the object is now a <code class="highlighter-rouge">Proc</code>, the <code class="highlighter-rouge">&amp;</code> converts the <code class="highlighter-rouge">Proc</code> into a <code class="highlighter-rouge">block</code>.</li>
</ul>

<p>Let‚Äôs go back to our initial example (and recall that the <code class="highlighter-rouge">first_method</code> 
converted the initial block to a <code class="highlighter-rouge">Proc</code> and passed that object to the 
<code class="highlighter-rouge">second_method</code>):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">second_method</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
  <span class="n">third_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">second_method</code> receives a <code class="highlighter-rouge">Proc</code> object, assigned to the local variable
<code class="highlighter-rouge">block</code>. Within the method body, a <code class="highlighter-rouge">third_method</code> is called, with <code class="highlighter-rouge">&amp;block</code>
passed to it as an argument.</p>

<p>As we‚Äôre here in the context of a <strong>method invocation</strong>, the <code class="highlighter-rouge">&amp;</code> does the
following:</p>

<ol>
  <li>Checks whether <code class="highlighter-rouge">block</code> is indeed a <code class="highlighter-rouge">Proc</code> (which it is)</li>
  <li>Converts the <code class="highlighter-rouge">Proc</code> into a block</li>
</ol>

<h2 id="explaining-our-initial-example">Explaining our initial example</h2>

<p>We now have everything required to understand our initial example! Let‚Äôs 
rewrite it with more self-explanatory names:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">block_to_proc_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block_to_proc</span><span class="p">)</span>
  <span class="n">proc_to_block_method</span><span class="p">(</span><span class="n">block_to_proc</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">proc_to_block_method</span><span class="p">(</span><span class="n">proc_to_block</span><span class="p">)</span>
  <span class="n">call_the_block_to_proc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proc_to_block</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">call_the_block_to_proc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block_to_proc</span><span class="p">)</span>
  <span class="n">block_to_proc</span><span class="p">.</span><span class="nf">call</span>
<span class="k">end</span>

<span class="n">block_to_proc_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hello!"</span> <span class="p">}</span>
</code></pre></div></div>

<p>Let‚Äôs explain the program step-by-step, thanks to our new understanding
of the subtleties behind the <code class="highlighter-rouge">&amp;</code>:</p>

<ul>
  <li>At first, the <code class="highlighter-rouge">block_to_proc_method</code> is invoked, with a block 
<code class="highlighter-rouge">{ puts "hello!" }</code> passed to it as an argument.</li>
  <li>The block <code class="highlighter-rouge">{ puts "hello!" }</code> is converted to a <code class="highlighter-rouge">Proc</code> object thanks to the
<code class="highlighter-rouge">&amp;</code> prefixed within <code class="highlighter-rouge">block_to_proc</code>‚Äôs method definition. This <code class="highlighter-rouge">Proc</code> is 
assigned to the local variable <code class="highlighter-rouge">block_to_proc</code>.</li>
  <li>Within the first method‚Äôs body, a second method is invoked
(<code class="highlighter-rouge">proc_to_block_method</code>), with the <code class="highlighter-rouge">Proc</code> passed to it as an argument.</li>
  <li>The <code class="highlighter-rouge">proc_to_block_method</code> initializes the local variable <code class="highlighter-rouge">proc_to_block</code> 
and assigns the <code class="highlighter-rouge">Proc</code> object to it.</li>
  <li>Within the second method‚Äôs body, a third method is invoked 
(<code class="highlighter-rouge">call_the_block_to_proc</code>), with <code class="highlighter-rouge">&amp;proc_to_block</code> passed to it as an argument.
In the context of a method invocation, that <code class="highlighter-rouge">&amp;</code> first checks whether
<code class="highlighter-rouge">proc_to_block</code> is a <code class="highlighter-rouge">Proc</code> (it is) and then converts it to a block.</li>
  <li>The block received by <code class="highlighter-rouge">call_the_block_to_proc</code> is converted to a <code class="highlighter-rouge">Proc</code>
object because of the <code class="highlighter-rouge">&amp;</code> prefixed to the parameter within the method
definition. Therefore, <code class="highlighter-rouge">block_to_proc</code> refers to a <code class="highlighter-rouge">Proc</code> object within the 
third method‚Äôs body.</li>
  <li>The <code class="highlighter-rouge">Proc</code> is then called, which outputs <code class="highlighter-rouge">"hello!"</code>
</li>
</ul>

<div style="text-align: center">
    <figure>
        <a href="/assets/images/spongebob.gif">
            <img src="/assets/images/spongebob.gif" alt="Spongebob Squarepants goes Phew">  
        </a>
        <figcaption>Phew! We made it</figcaption>
    </figure>
</div>

<h2 id="tldr---its-all-about-context">TL;DR - It‚Äôs all about context!</h2>

<p>To sum up, an <code class="highlighter-rouge">&amp;</code> prefixing an object can do two opposite actions, depending
on the <em>context</em>:</p>

<ul>
  <li>Within a <strong>method definition</strong>, the <code class="highlighter-rouge">&amp;</code> converts a block (passed as an 
argument) to a <code class="highlighter-rouge">Proc</code>
</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>   <span class="c1"># &amp; within a method definition</span>
  <span class="n">block</span><span class="p">.</span><span class="nf">call</span>
<span class="k">end</span>

<span class="n">some_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"hi from the explicit block!"</span> <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Within a <strong>method invocation</strong>, the <code class="highlighter-rouge">&amp;</code> first converts the object to a <code class="highlighter-rouge">Proc</code>,
and then converts the <code class="highlighter-rouge">Proc</code> to a block</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:odd?</span><span class="p">)</span>    <span class="c1"># &amp; within a method invocation</span>
</code></pre></div></div>


    



<div class="post-tags">
  
    
    <a href="/tags#ruby">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Ruby</span>
    </a>
  
    
    <a href="/tags#ruby-quirks">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Ruby Quirks</span>
    </a>
  
    
    <a href="/tags#closures">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Closures</span>
    </a>
  
    
    <a href="/tags#learning">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Learning</span>
    </a>
  
    
    <a href="/tags#ampersand">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Ampersand</span>
    </a>
  
    
    <a href="/tags#block">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Block</span>
    </a>
  
    
    <a href="/tags#proc">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>¬†<span class="tag-name">Proc</span>
    </a>
  
</div>
    <div class="post-dates">
  <!--<span class="post-date">Created: 09 Sep 2019</span>-->
  <!--  &bull;-->
  
  <span class="post-date">Last Modified: 09 Sep 2019</span>
 
 <!-- <span class="post-categories">-->
 <!--   -->
 <!--     &bull;-->
 <!--     -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->
 <!--       -->
 <!--     -->

 <!--     -->
 <!--       Ruby-->
 <!--     -->
 <!---->
 <!--</span>-->
</div>
  </div>
  
  <hr>
<script src="https://utteranc.es/client.js" repo="jsiny/jsiny.github.io" issue-term="pathname" label=":speech_balloon: Comments" theme="github-light" crossorigin="anonymous" async>
</script>

  <div class="relatedPosts">
<hr>
<h4>You May Also Enjoy</h4>





  

    
    

    

    

  

    
    

    

    
      <div>
      <h5><a href="/preparing-launch-school-109-oral-assessment">How I Prepared for Launch School's 109 Oral Assessment</a></h5>
      </div>
      
      
    

  

    
    

    

    
      <div>
      <h5><a href="/ruby-equality">Making Sense of Equality in Ruby</a></h5>
      </div>
      
      
    

  

    
    

    

    
      <div>
      <h5><a href="/codewars-kata-launch-school-109-oral-assessment">My Favourite Codewars Kata to Prepare for Launch School's 109 Oral Assessment</a></h5>
      </div>
      
      
    

  

    
    

    

    
      <div>
      <h5><a href="/preparing-launch-school-109-written-assessment">How I Prepared for Launch School's 109 Written Assessment</a></h5>
      </div>
      
      
        

</div>
</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>